<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.laokou.auth.server.domain.sys.repository.mapper.SysMenuMapper">
    <select id="getPermissionsList" resultType="string" flushCache="true">
        SELECT permissions FROM boot_sys_menu
        where del_flag = '0'
        GROUP BY permissions
    </select>

    <select id="getPermissionsListByUserId" resultType="string" flushCache="true">
        SELECT boot_sys_menu.permissions FROM boot_sys_menu
        ,boot_sys_role
        ,boot_sys_role_menu
        ,boot_sys_user
        ,boot_sys_user_role
        ,mysql.help_topic
        WHERE boot_sys_menu.id = boot_sys_role_menu.menu_id
        AND boot_sys_role_menu.role_id = boot_sys_role.id
        AND boot_sys_user.id = boot_sys_user_role.user_id
        AND boot_sys_role.id = boot_sys_user_role.role_id
        AND boot_sys_user.id = #{userId}
        and boot_sys_menu.del_flag = '0'
        GROUP BY boot_sys_menu.permissions
    </select>

    <select id="getMenuList" resultType="org.laokou.auth.client.vo.SysMenuVO" flushCache="true">
        select id,pid,`name`,icon,url,`method`,auth_level,type,permissions from boot_sys_menu
        where del_flag = '0'
        <if test="type != null">
            and type = #{type}
        </if>
        group by id,pid,`name`,icon,url,`method`,auth_level,type,permissions
        order by sort desc
    </select>

    <select id="getMenuListByUserId" resultType="org.laokou.auth.client.vo.SysMenuVO" flushCache="true">
        SELECT boot_sys_menu.url,
        boot_sys_menu.type,
        boot_sys_menu.sort,
        boot_sys_menu.id,
        boot_sys_menu.pid,
        boot_sys_menu.name,
        boot_sys_menu.icon,
        boot_sys_menu.auth_level,
        boot_sys_menu.method,
        boot_sys_menu.permissions
        FROM boot_sys_menu
        ,boot_sys_role
        ,boot_sys_role_menu
        ,boot_sys_user
        ,boot_sys_user_role
        WHERE boot_sys_menu.id = boot_sys_role_menu.menu_id
        AND boot_sys_role_menu.role_id = boot_sys_role.id
        AND boot_sys_user.id = boot_sys_user_role.user_id
        AND boot_sys_role.id = boot_sys_user_role.role_id
        AND boot_sys_user.id = #{userId}
        and boot_sys_menu.del_flag = '0'
        <if test="type != null">
            and boot_sys_menu.type = #{type}
        </if>
        group by boot_sys_menu.url,
        boot_sys_menu.type,
        boot_sys_menu.sort,
        boot_sys_menu.id,
        boot_sys_menu.pid,
        boot_sys_menu.name,
        boot_sys_menu.icon,
        boot_sys_menu.auth_level,
        boot_sys_menu.method,
        boot_sys_menu.permissions
        order by boot_sys_menu.sort desc
    </select>
</mapper>
